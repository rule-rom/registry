# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Clang AST

> **–ü–∞—Ä—Å–∏–Ω–≥ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã C/C++ –∫–æ–¥–∞ —á–µ—Ä–µ–∑ Abstract Syntax Tree.**

## –û–±–∑–æ—Ä

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Clang AST –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–≥–æ –¥–µ—Ä–µ–≤–∞, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –±–µ–∑ —ç–≤—Ä–∏—Å—Ç–∏–∫.

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è AST

Clang –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç JSON-–¥–∞–º–ø –¥–µ—Ä–µ–≤–∞ —á–µ—Ä–µ–∑ —Ñ–ª–∞–≥:

```powershell
clang -Xclang -ast-dump=json -fsyntax-only source.c > ast.json
```

### 2. –ü–∞—Ä—Å–∏–Ω–≥ AST

Babashka-—Å–∫—Ä–∏–ø—Ç —á–∏—Ç–∞–µ—Ç JSON –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç:

- –í—ã–∑–æ–≤—ã —Ñ—É–Ω–∫—Ü–∏–π (`CallExpr`)
- –û–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏—è (`BinaryOperator`)
- –î–æ—Å—Ç—É–ø –∫ –ø–∞–º—è—Ç–∏ (`MemberExpr`, `ArraySubscriptExpr`)
- –ü—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–æ–≤ (`CastExpr`)

### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—Ç–∏–≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤

–ò–∑–≤–ª–µ—á—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–≤–µ—Ä—è—é—Ç—Å—è —Å EDN-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏ –∏–∑ —Ä–µ–µ—Å—Ç—Ä–∞.

## –ü—Ä–∏–º–µ—Ä AST

```json
{
  "id": "0x1234",
  "kind": "CallExpr",
  "type": "void",
  "inner": [
    {
      "kind": "ImplicitCastExpr",
      "inner": [{ "kind": "DeclRefExpr", "name": "free" }]
    },
    { "kind": "ImplicitCastExpr", "name": "ptr" }
  ]
}
```

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –í–∞–ª–∏–¥–∞—Ü–∏—è safe-free

```edn
{:intent :safe-free
 :match {:kind "CallExpr" :name "free"}
 :ensure-next {:kind "BinaryOperator" :opcode "=" :value "NULL"}}
```

```c
// [[garden:intent(safe-free)]]
void cleanup(void* ptr) {
    free(ptr);
    ptr = NULL;  // ‚úì –ü—Ä–æ—Ö–æ–¥–∏—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é
}
// [[/garden:intent]]
```

## –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

| –£—Ç–∏–ª–∏—Ç–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|------------|
| `clang -ast-dump=json` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JSON AST |
| `bb -m garden.enforcer` | –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—Ç–∏–≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ |
| `bb -m garden.echo` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Markdown-–æ—Ç—á—ë—Ç–æ–≤ |

## –°—Å—ã–ª–∫–∏

- [Garden-Core Enforcer](enforcer.md)
- [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–∞–º—è—Ç–∏](../registry/memory_safety.md)

---

**Bake the Future. Build the Substrate.** üõ†Ô∏è‚ö°Ô∏è
